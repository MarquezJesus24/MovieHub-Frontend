<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <h1>üé¨ Administraci√≥n de Pel√≠culas</h1>
      <p class="subtitle">Gestiona el cat√°logo completo</p>
    </div>
    <button class="btn-primary" (click)="createMovie()">
      ‚ûï Nueva Pel√≠cula
    </button>
  </header>
   <div class="toolbar">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Buscar por nombre o descripci√≥n..."
        [value]="searchTerm()"
        (input)="onSearchChange($any($event.target).value)"
      >
    </div>
    <div class="filter-box">
      <label>Estado:</label>
      <select 
        [value]="filterStatus()"
        (change)="onFilterChange($any($event.target).value)"
      >
        <option value="TODOS">Todos</option>
        <option value="publicada">Publicadas</option>
        <option value="edicion">En Edici√≥n</option>
      </select>
    </div>
    <button 
      class="btn-refresh" 
      (click)="loadMovies()"
      [disabled]="loading()"
    >
      üîÑ Actualizar
    </button>
  </div>
  @if (!loading() && !error()) {
    <div class="info-bar">
      <p>
        Mostrando <strong>{{ filteredMovies().length }}</strong> 
        de <strong>{{ movies().length }}</strong> pel√≠culas
      </p>
    </div>
  }
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando pel√≠culas...</p>
    </div>
  }
  @if (error() && !loading()) {
    <div class="error-container">
      <p class="error-message">{{ error() }}</p>
      <button class="btn-retry" (click)="loadMovies()">
        Reintentar
      </button>
    </div>
  }

  @if (!loading() && !error()) {
    <div class="table-container">
      <table class="movies-table">
        <thead>
          <tr>
            <th>posterPath</th>
            <th>Nombre</th>
            <th>Descripci√≥n</th>
            <th>rating</th>
            <th>Estado</th>
            <th>Fecha Creaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (movie of filteredMovies(); track movie.id) {
            <tr>             
              <td>
                <img 
                  [src]="movie.posterPath" 
                  [alt]="movie.name" 
                  class="thumbnail"
                >
              </td>
              <td class="movie-name">{{ movie.name }}</td>            
              <td class="movie-description">
                {{ movie.description.substring(0, 80) }}
                @if (movie.description.length > 80) {
                  <span>...</span>
                }
              </td>
              <td class="rating">
                <span class="stars">‚≠ê</span>
                {{ movie.rating.toFixed(1) }}
              </td>
              <td>
                <span 
                  class="badge"
                  [class]="getStatusClass(movie.status)"
                >
                  {{ movie.status }}
                </span>
              </td>
              <td>{{ movie.createAt| date:'dd/MM/yyyy HH:mm' }}</td>
              <td class="actions">
                <div class="action-buttons">                
                  <button 
                    class="btn-icon btn-edit"
                    (click)="editMovie(movie.id)"
                    title="Editar"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button 
                    class="btn-icon btn-toggle"
                    (click)="toggleStatus(movie)"
                    [title]="movie.status === 'publicada' ? 'Despublicar' : 'Publicar'"
                  >
                    {{ movie.status === 'publicada' ? 'üì§' : 'üì•' }}
                  </button>
                  <button 
                    class="btn-icon btn-delete"
                    (click)="deleteMovie(movie)"
                    title="Eliminar"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
            
          } @empty {            
            <tr>
              <td colspan="8" class="no-results">
                <p>No se encontraron pel√≠culas</p>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>